sap.ui.define(["sap/ui/core/mvc/Controller","../model/models","sap/ui/core/Fragment"],function(e,t,a){"use strict";return e.extend("employeemanagement.controller.CreateEmployee",{onInit:function(){this.getView().setModel(new sap.ui.model.json.JSONModel({avatarSrc:""}),"viewModel");this._validateDobCheck=true;this._validateHireCheck=true},onInputForm:function(e){this.resetForm();const t=this.getOwnerComponent().getRouter();t.navTo("CreateEmployee")},onEmpList:function(e){this.resetForm();const t=this.getOwnerComponent().getRouter();t.navTo("OverviewPage")},onMasterData:function(){this.resetForm();const e=this.getOwnerComponent().getRouter();e.navTo("MasterDataPage")},onAvatarPress:function(){const e=this.byId("fileUploader");e.setValue("");e.getFocusDomRef().click()},onUploadImage:function(e){const t=e.getParameter("files")[0];const a=this.byId("avatar");if(t&&FileReader){const e=new FileReader;e.onload=function(e){a.setSrc(e.target.result)};e.readAsDataURL(t)}},onDeleteImage:function(){const e=this.byId("avatar");e.setSrc("")},onEmailChange:function(e){const t=e.getParameter("value").trim();const a=e.getSource();const s=this._validateEmail(t);if(!s){a.setValueState("Error");a.setValueStateText("Please enter a valid email address.")}else{a.setValueState("None")}},validateDOB:function(e){const t=e.getSource();const a=e.getParameter("value");if(!a){t.setValueState("Error");t.setValueStateText("Date of birth is required.");this._validateDobCheck=false;return}const s=new Date(a);const o=new Date;if(isNaN(s.getTime())){t.setValueState("Error");t.setValueStateText("Invalid date format. Please enter a valid date.");this._validateDobCheck=false;return}let i=o.getFullYear()-s.getFullYear();const r=o.getMonth()-s.getMonth();const n=o.getDate()-s.getDate();if(r<0||r===0&&n<0){i--}if(i<18){t.setValueState("Error");t.setValueStateText("Employee must be at least 18 years old.");this._validateDobCheck=false}else{t.setValueState("None");t.setValueStateText("");this._validateDobCheck=true}},validateHireDate:function(e){const t=e.getSource();const a=e.getParameter("value");if(!a){t.setValueState("Error");t.setValueStateText("Hire Date is required.");this._validateHireCheck=false;return}const s=new Date(a);if(isNaN(s.getTime())){t.setValueState("Error");t.setValueStateText("Invalid Hire Date format.");this._validateHireCheck=false;return}const o=new Date;o.setHours(0,0,0,0);if(s>o){t.setValueState("Error");t.setValueStateText("Hire Date cannot be in the future.");this._validateHireCheck=false}else{t.setValueState("None");t.setValueStateText("");this._validateHireCheck=true}},_validateEmail:function(e){const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return t.test(e)},onValidateEmail:async function(){const e=this.byId("email1").getValue().trim();const t=this.getOwnerComponent().getModel("EmployeeModel");let a=false;try{const s=await t.bindList("/Employees").requestContexts();const o=s.some(t=>{const a=t.getObject();return a.email?.toLowerCase()===e.toLowerCase()});if(o){this.byId("email1").setValueState("Error");this.byId("email1").setValueStateText("This email already exists.");sap.m.MessageToast.show("This email already exists.");a=false;return a}else{this.byId("email1").setValueState("None");a=true;return a}}catch(e){console.error("Failed to read employees",e);sap.m.MessageToast.show("Failed to check existing emails.");a=false;return a}},_validateRequiredFields:function(){const e=this.getView();let t=true;const a=[e.byId("name111"),e.byId("name121"),e.byId("gender1"),e.byId("dob1"),e.byId("department1"),e.byId("wfrom1"),e.byId("role1"),e.byId("email1")];a.forEach(function(e){const a=e.getValue?.()||e.getSelectedKey?.();if(!a){e.setValueState("Error");e.setValueStateText("This field is required");t=false}else{e.setValueState("None")}});return t},onSubmit:async function(){if(!this._validateRequiredFields()){sap.m.MessageToast.show("Please fill all required fields.");return}if(!this._validateDobCheck){sap.m.MessageToast.show("Invalid Date of Birth field.");return}if(!this._validateHireCheck){sap.m.MessageToast.show("Invalid Hire Date field.");return}const e=this.byId("email1").getValue().trim();const t=this._validateEmail(e);if(!t){this.byId("email1").setValueState("Error");this.byId("email1").setValueStateText("Please enter a valid email address.");sap.m.MessageToast.show("Please enter a valid email address.");return}else{this.byId("email1").setValueState("None")}const a=await this.onValidateEmail();if(!a){return}this._openConfirmDialog({title:"Confirm Create",message:"Are you sure you want to create this employee?",state:"Information",confirmText:"Create",cancelText:"Cancel"})},_openConfirmDialog:function(e){if(!this._oConfirmDialog){a.load({id:this.getView().getId(),name:"employeemanagement.view.fragment.ConfirmDialog",controller:this}).then(function(t){this._oConfirmDialog=t;this.getView().addDependent(t);this._setDialogProperties(e);t.open()}.bind(this))}else{this._setDialogProperties(e);this._oConfirmDialog.open()}},_setDialogProperties:function(e){const t=new sap.ui.model.json.JSONModel({dialogTitle:e.title,dialogMessage:e.message,dialogState:e.state,confirmText:e.confirmText,cancelText:e.cancelText});this._oConfirmDialog.setModel(t,"dialog")},_setValidateCheck:function(){this._validateDobCheck=true;this._validateHireCheck=true},onConfirm:function(){this.onConfirmSubmit();this._setValidateCheck()},onCancel:function(){this._oConfirmDialog.close();this._setValidateCheck()},onConfirmSubmit:async function(){const e=this.getView();const t=this.getOwnerComponent().getModel("EmployeeModel");let a=e.byId("role1").getSelectedKey();let s=e.byId("wfrom1").getDateValue();const o=this.getView().getModel("MasterDataModel").getProperty("/roles");const i=o.find(e=>e.ID===a);if(!i){sap.m.MessageBox.information("Selected role not found.");return}const r=parseFloat(i.baseSalary||0);const n=new Date;let l=n.getFullYear()-s.getFullYear();const d=n.getMonth()-s.getMonth();const c=n.getDate()-s.getDate();if(d<0||d===0&&c<0){l--}const u=l*1e3;const m=r+u;const g={firstName:e.byId("name111").getValue(),lastName:e.byId("name121").getValue(),gender:e.byId("gender1").getSelectedKey(),dateOfBirth:e.byId("dob1").getDateValue()?.toISOString().slice(0,10),hireDate:e.byId("wfrom1").getDateValue()?.toISOString().slice(0,10),email:e.byId("email1").getValue(),role_ID:e.byId("role1").getSelectedKey(),salary:m,department_ID:e.byId("department1").getSelectedKey()};try{const e=t.bindList("/Employees");const a=await e.create(g).created();sap.m.MessageToast.show("Employee created successfully");const s=sap.ui.getCore().byId("container-employeemanagement---OverviewPage--employeeTable");if(s){const e=s.getBinding("items");e?.refresh()}this.resetForm();this._oConfirmDialog.close();this.getOwnerComponent().getRouter().navTo("OverviewPage")}catch(e){console.error("Error creating employee:",e);const t=e.details||e.messages;if(t&&Array.isArray(t)){t.forEach(e=>{console.error(`â€¢ ${e.message} (${e.code})`)})}sap.m.MessageBox.error("Failed to create employee:\n"+(t?.map(e=>e.message).join("\n")||e.message))}},resetForm:function(){const e=this.getView();e.byId("name111").setValue("");e.byId("name121").setValue("");e.byId("gender1").setSelectedKey("");e.byId("dob1").setValue("");e.byId("department1").setSelectedKey("");e.byId("wfrom1").setValue("");e.byId("role1").setSelectedKey("");e.byId("email1").setValue("");e.byId("email1").setValueState("None");this.getView().getModel("viewModel").setProperty("/avatarSrc","")},onRoleChange:function(e){const t=e.getSource();const a=t.getValue().trim();const s=t.getItems();let o=false;let i=null;for(let e=0;e<s.length;e++){const t=s[e];if(t.getText().toLowerCase()===a.toLowerCase()){o=true;i=t.getKey();break}}if(o){t.setValueState("None");t.setSelectedKey(i)}else{t.setValueState("Error");t.setValueStateText("Invalid selected. Please choose from the list.");t.setSelectedKey("")}}})});
//# sourceMappingURL=CreateEmployee.controller.js.map